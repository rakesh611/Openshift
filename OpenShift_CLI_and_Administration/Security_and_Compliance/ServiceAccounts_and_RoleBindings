üß© 1. What is a ServiceAccount in OpenShift?
üîç Definition:
A ServiceAccount (SA) is an identity used by pods or automation processes (like CI/CD pipelines, controllers, or operators) 
to access the OpenShift API securely ‚Äî without using a user‚Äôs personal credentials.
It‚Äôs like a ‚Äúrobot user‚Äù for applications running inside the cluster.

üß† Purpose:
Provide authentication for pods and system components.
Allow fine-grained access control via RoleBindings.
Enable automation (Jenkins, Prometheus, etc.) to interact with the API.

üìò Default ServiceAccounts:
Each OpenShift project (namespace) automatically gets these:
| ServiceAccount | Purpose                                             |
| -------------- | --------------------------------------------------- |
| `default`      | Used by pods that don‚Äôt specify another SA          |
| `builder`      | Used for BuildConfigs to access image streams, etc. |
| `deployer`     | Used by DeploymentConfigs to manage deployments     |

üßæ Example: Creating a ServiceAccount
oc create serviceaccount myapp-sa -n myproject

Verify:
oc get serviceaccounts -n myproject

Output:
NAME         SECRETS   AGE
builder      2         10d
deployer     2         10d
default      2         10d
myapp-sa     1         2m

üîë Use in Pod or Deployment

Attach it to a pod or deployment so that pod uses this ServiceAccount:

apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 1
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      serviceAccountName: myapp-sa   # <--- ServiceAccount attached
      containers:
      - name: app
        image: nginx
Apply:
oc apply -f myapp-deployment.yaml

üß© Now, your pod authenticates to the API using myapp-sa.

üß© 2. Role, ClusterRole, and RoleBinding Overview
OpenShift uses RBAC (Role-Based Access Control) to decide what a user or ServiceAccount can do.

üìú RBAC Key Objects
| Object                 | Scope        | Purpose                                                                       |
| ---------------------- | ------------ | ----------------------------------------------------------------------------- |
| **Role**               | Namespace    | Defines permissions (verbs, resources) for a specific namespace               |
| **ClusterRole**        | Cluster-wide | Defines permissions across the entire cluster                                 |
| **RoleBinding**        | Namespace    | Grants a Role to a user/group/ServiceAccount **within a namespace**           |
| **ClusterRoleBinding** | Cluster-wide | Grants a ClusterRole to a user/group/ServiceAccount **across all namespaces** |

üß© 3. Role Example
Let‚Äôs create a Role that allows reading Pods only.

üßæ YAML Example:

apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: myproject
  name: pod-reader
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "watch"]


Apply:
oc apply -f pod-reader-role.yaml

üß© 4. RoleBinding Example
Now, bind the above Role to the ServiceAccount (myapp-sa).

üßæ YAML Example:

apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: read-pods-binding
  namespace: myproject
subjects:
- kind: ServiceAccount
  name: myapp-sa
  namespace: myproject
roleRef:
  kind: Role
  name: pod-reader
  apiGroup: rbac.authorization.k8s.io

Apply:
oc apply -f rolebinding.yaml

üß† What Happens:
Now, myapp-sa can:
get, list, and watch Pods only in myproject
It cannot delete, create, or modify pods
It cannot access other namespaces

üß© 5. ClusterRole and ClusterRoleBinding
When you need cluster-wide permissions, use ClusterRole and ClusterRoleBinding.

üìò Example: ClusterRole

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: cluster-pod-reader
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "watch"]

üìò ClusterRoleBinding

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cluster-read-pods-binding
subjects:
- kind: ServiceAccount
  name: myapp-sa
  namespace: myproject
roleRef:
  kind: ClusterRole
  name: cluster-pod-reader
  apiGroup: rbac.authorization.k8s.io

üü¢ This allows myapp-sa to read pods in all namespaces.


üß© 6. Verify Permissions
To test if the ServiceAccount has certain permissions:
oc auth can-i get pods --as system:serviceaccount:myproject:myapp-sa -n myproject

Output:
yes
If ‚Äúno‚Äù ‚Üí check your Role or RoleBinding setup.

üß© 7. Common Use Cases in OpenShift
| Use Case                      | ServiceAccount      | Role/RoleBinding Purpose                |
| ----------------------------- | ------------------- | --------------------------------------- |
| Jenkins pipeline deployment   | `jenkins`           | Deploy apps using OpenShift API         |
| Monitoring tools (Prometheus) | `prometheus-k8s`    | Access metrics endpoints                |
| Application accessing API     | Custom `app-sa`     | Read ConfigMaps, Pods, or Secrets       |
| Operators                     | Operator-managed SA | Manage resources in specific namespaces |

üß© 8. View Existing Roles & Bindings

List all Roles:
oc get role -n myproject

List all RoleBindings:
oc get rolebinding -n myproject

View details:
oc describe rolebinding <binding-name> -n myproject

üß© 9. Summary Table
| Component          | Scope     | Purpose                         | Command                        |
| ------------------ | --------- | ------------------------------- | ------------------------------ |
| ServiceAccount     | Namespace | Identity for pods               | `oc create serviceaccount`     |
| Role               | Namespace | Defines allowed actions         | `oc create role`               |
| RoleBinding        | Namespace | Assign Role to SA/User          | `oc create rolebinding`        |
| ClusterRole        | Cluster   | Cluster-wide permissions        | `oc create clusterrole`        |
| ClusterRoleBinding | Cluster   | Assign ClusterRole cluster-wide | `oc create clusterrolebinding` |

üß© 10. Example Workflow (Quick Recap)
# 1. Create ServiceAccount
oc create sa myapp-sa -n myproject

# 2. Create Role
oc create role pod-reader --verb=get,list,watch --resource=pods -n myproject

# 3. Bind Role to ServiceAccount
oc create rolebinding read-pods-binding --role=pod-reader --serviceaccount=myproject:myapp-sa -n myproject

# 4. Verify
oc auth can-i get pods --as system:serviceaccount:myproject:myapp-sa -n myproject

