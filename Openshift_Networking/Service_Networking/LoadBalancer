üåê LoadBalancer Service Networking in OpenShift

üß† 1Ô∏è‚É£ What Is a LoadBalancer Service?
A LoadBalancer Service in OpenShift (and Kubernetes) is a type of Service that:
Exposes an application externally through a cloud provider‚Äôs load balancer (AWS ELB, GCP LB, Azure LB, etc.)
Still has a ClusterIP internally for intra-cluster traffic
Provides automatic external IP assignment (if integrated with cloud provider)
In OpenShift on bare-metal or on-prem clusters, LoadBalancer is usually simulated via MetalLB or handled via an external router/load balancer.

üèóÔ∏è 2Ô∏è‚É£ How It Works
User creates a LoadBalancer Service:
oc expose deployment myapp --port=8080 --type=LoadBalancer
OpenShift assigns:

A ClusterIP (from Service Network) for internal traffic
A LoadBalancer IP (if cloud provider supports) for external access
OVN-Kubernetes sets up logical load balancer rules:
ClusterIP ‚Üí Backend Pods
LoadBalancer IP ‚Üí ClusterIP ‚Üí Backend Pods
External traffic is routed via the LB IP to the nodes, then distributed to backend pods.

üì¶ Example Output
oc get svc myapp
NAME     TYPE           CLUSTER-IP      EXTERNAL-IP    PORT(S)          AGE
myapp    LoadBalancer   172.30.55.12    34.122.10.55  8080:32456/TCP   5m
ClusterIP: 172.30.55.12 (Service Network)
External LB IP: 34.122.10.55 (provided by cloud LB)
NodePort: 32456 (used internally for node routing)

‚öôÔ∏è 3Ô∏è‚É£ Packet Flow (OVN-Kubernetes)
Pod-to-Pod (Internal)
Pod ‚Üí ClusterIP ‚Üí Backend Pod
External Client ‚Üí LoadBalancer
External Client
        ‚îÇ
  LoadBalancer IP (Cloud/External LB)
        ‚îÇ
NodePort / Node IP
        ‚îÇ
ClusterIP (Service Network)
        ‚îÇ
OVN Logical LB
        ‚îÇ
Backend Pods

üß© 4Ô∏è‚É£ LoadBalancer vs NodePort vs ClusterIP
| Feature        | ClusterIP             | NodePort                             | LoadBalancer                             |
| -------------- | --------------------- | ------------------------------------ | ---------------------------------------- |
| Scope          | Internal only         | External via Node IP:Port            | External via LB IP                       |
| External IP    | ‚ùå                     | ‚úÖ (Node IP)                          | ‚úÖ (LB IP)                                |
| Use Case       | Pod‚ÜîPod communication | Dev/testing, limited external access | Production external access with cloud LB |
| Load Balancing | Internal OVN LB       | NodePort round-robin                 | Cloud LB + OVN LB                        |

üîß 5Ô∏è‚É£ How OVN-Kubernetes Implements LoadBalancer
In OVN-Kubernetes (OCP 4.x):
ClusterIP Service is created first
LoadBalancer IP (external) is assigned if supported
OVN‚Äôs distributed logical load balancer maps:
<LoadBalancer IP>:<Port> ‚Üí <ClusterIP>:<Port> ‚Üí <Backend Pod IPs>
Traffic from any node can reach backend pods without extra NAT, because OVN handles distributed LB at L3.

üîπ Example OVN Load Balancer Entry
oc exec -n openshift-ovn-kubernetes ovnkube-master-<pod> -- ovn-nbctl list load_balancer
vips: {
  "172.30.55.12:8080"="10.128.2.14:8080,10.128.3.19:8080",
  "34.122.10.55:8080"="10.128.2.14:8080,10.128.3.19:8080"
}
Both ClusterIP and LoadBalancer IP point to same backend pods.
OVN ensures distributed routing across nodes.

üß≠ 6Ô∏è‚É£ LoadBalancer on Bare-metal
On on-prem/bare-metal OpenShift clusters:
OpenShift cannot automatically provision cloud LB

Options:
MetalLB: Provides external IPs for LoadBalancer Services
OpenShift Routes / Ingress: Recommended for HTTP/HTTPS exposure

üìä 7Ô∏è‚É£ Summary Table: Service Types in OpenShift
| Type            | Internal IP | External IP      | Exposure            | Best Use   |
| --------------- | ----------- | ---------------- | ------------------- | ---------- |
| ClusterIP       | ‚úÖ           | ‚ùå                | Internal only       | Pod-to-Pod |
| NodePort        | ‚úÖ           | ‚úÖ (Node IP:Port) | Limited external    | Dev/Test   |
| LoadBalancer    | ‚úÖ           | ‚úÖ (Cloud LB IP)  | Production external | Prod apps  |
| Route / Ingress | Optional    | ‚úÖ (HTTP/S)       | Production external | Web apps   |

üîë 8Ô∏è‚É£ Key Takeaways
LoadBalancer Service = External access + automatic load balancing
Works with ClusterIP internally
In OCP 4.x with OVN-Kubernetes, implemented as distributed OVN logical load balancer
On bare-metal, must simulate with MetalLB or use Routes for external access
Provides scalable and production-ready access to services
